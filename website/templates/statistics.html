<!doctype html>
<html lang="en">
<head>
    <title>Books4u</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700,800,900" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="./static/css/style.css">
    <link href="./static/admin/vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet">
    <link href="./static/admin/css/sb-admin-2.min.css" rel="stylesheet">
    <link href="./static/admin/vendor/datatables/dataTables.bootstrap4.min.css" rel="stylesheet">
</head>
<body>
<style>
    img {
        margin: 10px;
    }
</style>
<div class="wrapper d-flex align-items-stretch">
    <nav id="sidebar" class="active" style="background: #22c55e;">
        <a href="/home" class="logo">Books4u</a>
        <ul class="list-unstyled components mb-5">
            <li class="active">
                <a href="/home"><span class="fa fa-home"></span> Home</a>
            </li>
            <li>
                <a href="/expenses"><span class="fa fa-money"></span> Expenses</a>
            </li>
            <li>
                <a href="/assets"><span class="fa fa-university"></span> Assets</a>
            </li>
            <li>
                <a href="/liabilities"><span class="fa fa-credit-card"></span> Liabilities</a>
            </li>
            <li>
                <a href="/statistics"><span class="fa fa-bar-chart"></span> Statistics</a>
            </li>
            <li>
                <a href="/logout"><span class="fa fa-xmark"></span> Logout</a>
            </li>
        </ul>
        <div class="footer">
            <p>
                Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | Made by Molise Mahasele
            </p>
        </div>
    </nav>

    <div id="content" class="p-4 p-md-5">
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <div class="container-fluid">
                <button type="button" id="sidebarCollapse" class="btn" style="background: #22c55e; color: white;">
                    <i class="fa fa-bars"></i>
                    <span class="sr-only">Toggle Menu</span>
                </button>
                <button class="btn btn-dark d-inline-block d-lg-none ml-auto" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                    <i class="fa fa-bars"></i>
                </button>
            </div>
        </nav>

        <div class="container mt-4">
            <!-- New row for summary cards -->
            <div class="row mb-4">
                <!-- Profit Margin Card -->
                <div class="col-md-3">
                    <div class="card">
                        <div class="card-body text-center">
                            <h5 class="text-success">Profit Margin: {{ data.profit_margin | round(2) }}%</h5>
                        </div>
                    </div>
                </div>
                
                <!-- Revenue Growth Card -->
                <div class="col-md-3">
                    <div class="card">
                        <div class="card-body text-center">
                            <h5 class="text-primary">Revenue Growth: {{ data.revenue_growth | round(2) }}%</h5>
                        </div>
                    </div>
                </div>
                
                <!-- Asset Turnover Ratio Card -->
                <div class="col-md-3">
                    <div class="card">
                        <div class="card-body text-center">
                            <h5 class="text-warning">Asset Turnover Ratio: {{ data.asset_turnover_ratio | round(2) }}</h5>
                        </div>
                    </div>
                </div>
                
                <!-- Debt-to-Equity Ratio Card -->
                <div class="col-md-3">
                    <div class="card">
                        <div class="card-body text-center">
                            <h5 class="text-info">Debt-to-Equity Ratio: {{ data.debt_to_equity_ratio | round(2) }}</h5>
                        </div>
                    </div>
                </div>
            </div>
        
            <!-- Existing charts row -->
            <div class="row">
                <!-- Bar Chart for Total Incomes vs. Total Expenses -->
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-body">
                            <div id="incomeExpenseChart"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Pie Chart for Expense Description Frequency -->
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-body">
                            <div id="expenseDescriptionChart"></div>
                        </div>
                    </div>
                </div>
        
                <!-- Doughnut Chart for Total Costs of Liabilities and Assets -->
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-body">
                            <div id="liabilitiesAssetsChart"></div>
                        </div>
                    </div>
                </div>
            </div>
        
            <div class="row mt-4">
                <!-- Line Chart for Expenses Over Time -->
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-body">
                            <div id="expenseLineChart"></div>
                        </div>
                    </div>
                </div>
        
                <!-- Line Chart for Incomes Over Time -->
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-body">
                            <div id="incomeLineChart"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                // Data for bar chart
                var incomeExpenseData = [{
                    x: ['Total Incomes', 'Total Expenses'],
                    y: [{{ data.total_incomes }}, {{ data.total_expenses }}],
                    type: 'bar',
                    marker: {
                        color: ['#22c55e', '#f44336']
                    }
                }];
                
                var incomeExpenseLayout = {
                    title: 'Total Incomes vs. Total Expenses',
                    xaxis: { title: 'Category' },
                    yaxis: { title: 'Amount' }
                };
                
                Plotly.newPlot('incomeExpenseChart', incomeExpenseData, incomeExpenseLayout);
                
                // Data for pie chart
                var descriptionCounts = {{ data.description_counts | tojson }};
                var descriptionLabels = Object.keys(descriptionCounts);
                var descriptionValues = Object.values(descriptionCounts);
                
                var expenseDescriptionData = [{
                    labels: descriptionLabels,
                    values: descriptionValues,
                    type: 'pie',
                    marker: {
                        colors: ['#e74c3c', '#8e44ad', '#3498db', '#1abc9c', '#f39c12', '#d35400']
                    }
                }];
                
                var expenseDescriptionLayout = {
                    title: 'Expense Distribution',
                    height: 400
                };
                
                Plotly.newPlot('expenseDescriptionChart', expenseDescriptionData, expenseDescriptionLayout);
                
                // Data for doughnut chart
                var liabilitiesAssetsData = [{
                    labels: ['Total Liabilities', 'Total Assets'],
                    values: [{{ data.total_liabilities }}, {{ data.total_assets }}],
                    type: 'pie',
                    hole: 0.4,
                    marker: {
                        colors: ['#ff6384', '#36a2eb']
                    }
                }];
                
                var liabilitiesAssetsLayout = {
                    title: 'Total Costs of Liabilities vs. Assets',
                    height: 400
                };
                
                Plotly.newPlot('liabilitiesAssetsChart', liabilitiesAssetsData, liabilitiesAssetsLayout);
        
                // Data for expense line chart
                var expenseDates = {{ data.expense_data.date | tojson }};
                var expensePrices = {{ data.expense_data.price | tojson }};
                
                var expenseLineData = [{
                    x: expenseDates,
                    y: expensePrices,
                    type: 'scatter',
                    mode: 'lines+markers',
                    marker: {
                        color: '#f39c12'
                    }
                }];
                
                var expenseLineLayout = {
                    title: 'Expenses Over Time',
                    xaxis: { title: 'Date' },
                    yaxis: { title: 'Price' }
                };
                
                Plotly.newPlot('expenseLineChart', expenseLineData, expenseLineLayout);
        
                // Data for income line chart
                var incomeDates = {{ data.income_data.date | tojson }};
                var incomeTotals = {{ data.income_data.total | tojson }};
                
                var incomeLineData = [{
                    x: incomeDates,
                    y: incomeTotals,
                    type: 'scatter',
                    mode: 'lines+markers',
                    marker: {
                        color: '#22c55e'
                    }
                }];
                
                var incomeLineLayout = {
                    title: 'Incomes Over Time',
                    xaxis: { title: 'Date' },
                    yaxis: { title: 'Total' }
                };
                
                Plotly.newPlot('incomeLineChart', incomeLineData, incomeLineLayout);
            });
        </script>
    </div>
</div>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
<script src="./static/js/jquery.min.js"></script>
<script src="./static/js/popper.js"></script>
<script src="./static/js/bootstrap.min.js"></script>
<script src="./static/js/main.js"></script>
<script src="./static/admin/vendor/jquery/jquery.min.js"></script>
<script src="./static/admin/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="./static/admin/vendor/jquery-easing/jquery.easing.min.js"></script>
<script src="./static/admin/js/sb-admin-2.min.js"></script>
<script src="./static/admin/vendor/datatables/jquery.dataTables.min.js"></script>
<script src="./static/admin/vendor/datatables/dataTables.bootstrap4.min.js"></script>
<script src="./static/admin/js/demo/datatables-demo.js"></script>
</body>
</html>
